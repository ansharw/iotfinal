<html lang="id">
<head>
	<title>Chart Example</title>
</head>
<body>
	<!-- Tampilkan Chart -->
	<div style="width:75%;">
		<canvas id="canvas"></canvas>
	</div>

	<!-- Load JS yang dibutuhkan  -->
	<script
			src="https://code.jquery.com/jquery-3.6.0.min.js"
			integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
			crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
	<script>
		/**
		 * Reload chart func
		 */
		function reloadChart() {
			/**
			 * Inisialisasi variable awal
			 */
			let labelDariServer = [];
			let dataDariServer = [];
			/**
			 * Load data dengan AJAX
			 */
			$.getJSON( "data.php", function( data ) {
				$.each( data, function( key, val ) {
					/**
					 * Push ke array
					 */
					labelDariServer.push(val.date);
					dataDariServer.push(val.temp);
				});

				/**
				 * Masukan data tadi ke Chart.js
				 */
				const dataChart = {
					labels: labelDariServer,
					datasets: [{
						label: 'Kandang 1',
						data: dataDariServer,
						fill: false,
						borderColor: 'rgb(75, 192, 192)',
						tension: 0.1
					}]
				};
				let config = {
					type: 'line',
					data: dataChart,
					options: {
						animation: false
					}
				};

				/**
				 * Destroy chart before re-set value
				 */
				if (window.myLine !== undefined) {
					window.myLine.destroy();
				}

				let ctx = document.getElementById("canvas").getContext("2d");
				window.myLine = new Chart(ctx, config);
			});
		}

		/**
		 * Loop every 3 second
		 */
		setInterval(function(){
			reloadChart();
		}, 1000);
	</script>
</body>
</html>
